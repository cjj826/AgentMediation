from src.chat import *
import matplotlib.pyplot as plt

class Player:
    def __init__(self, name, state, global_prompt="", mode = "", args=None):
        self.name = name 
        self.state = state 
        self.global_prompt = global_prompt 
        self.args = args or {}
        self.state_history = [] 
        self.statement = "" 
        self.statement_history = "" 
        self.mediation_history = ""
        self.vent_history = "" 
        self.mode = mode

    def modify_strategy(self, state):
        """
        æ ¹æ®å½“å‰çš„å‘è¨€ï¼Œè®°å½•ç›®å‰çš„ç­–ç•¥ï¼Œä»¥æ–¹ä¾¿ä¹‹åçš„ç­–ç•¥è°ƒæ•´åˆç†æ€§
        """

        prompt = f"""ä»¥ä¸‹æ˜¯ä½ æœ€æ–°çš„ä¸€è½®å‘è¨€ï¼š
{state}

è¯·ä½ ç”¨ä¸€å¥è¯æ€»ç»“ä½ åœ¨æœ¬è½®å‘è¨€ä¸­æ‰€è¡¨è¾¾çš„**è°ˆåˆ¤æ¡ä»¶**ï¼Œè¦æ±‚çªå‡ºä»¥ä¸‹è¦ç´ ï¼š
- è´£ä»»æ¯”ä¾‹ä¸»å¼  ï¼ˆå¦‚â€œæˆ‘æ–¹æ‰¿æ‹…XX%ï¼Œå¯¹æ–¹æ‰¿æ‹…XX%â€ï¼‰ï¼›
- å…³é”®é‡‘é¢æˆ–èµ”å¿ä¸»å¼  ï¼ˆå¦‚â€œæ€»èµ”å¿é‡‘é¢ä¸ºXXå…ƒâ€ã€â€œé¦–ä»˜XXå…ƒâ€ç­‰ï¼‰ï¼›
- å½“å‰è®©æ­¥ï¼ˆåç»­åå•†è°ˆåˆ¤çš„åŸºç¡€ï¼Œå¯æ ¹æ®èº«ä»½é€æ­¥é€’å¢æˆ–é€’å‡ï¼‰ ï¼ˆå¦‚â€œæœ€å¤šæ¥å—XXå…ƒâ€ã€â€œè‡³å°‘å¯¹æ–¹éœ€æ‰¿æ‹…XXå…ƒâ€ç­‰ï¼‰ï¼›

è¯­è¨€è¦æ±‚ç®€æ´ã€æ˜ç¡®ã€å®¢è§‚ï¼Œè¯·ä¸è¦æ·»åŠ é¢å¤–çš„ä¸»è§‚æ€åº¦ã€‚è¯·å›ç­”ï¼š
"""
        messages=[{"role": "user", "content": self.generate_role_prompt() + prompt}]
        result = LLM(messages, self.args.model_name, self.args.temperature, self.args.max_tokens)
        self.strategy = result['result']
        print("\n\nè°ˆåˆ¤æ¡ä»¶: ", self.strategy)
        # self.strategy = state

    def add_statement_history(self, statement_history):
        """
        agent è‡ªå·±è®°å¿† ç«‹åœºè¡¨è¾¾ é˜¶æ®µçš„è®°å¿†
        """
#         prompt = f"""ä»¥ä¸‹æ˜¯ä½ åœ¨ç«‹åœºè¡¨è¾¾ï¼ˆè‡ªæˆ‘ä»‹ç»ï¼‰é˜¶æ®µç»å†çš„äº‹ä»¶è®°å½•ï¼Œè¯·ä½ å¯¹è¯¥è®°å½•è¿›è¡Œæ€»ç»“ï¼Œè¦åŒ…æ‹¬æ‰€æœ‰è¦ç‚¹ï¼Œå½¢æˆé•¿æœŸè®°å¿†ã€‚
# {statement_history}        
# è¯·è¾“å‡ºä¸€æ®µå‹ç¼©æè¿°ï¼š      
# """
#         messages=[{"role": "system", "content": self.generate_role_prompt()},
#                       {"role": "user", "content": prompt}]
#         result = LLM(messages, self.args.model_name, self.args.temperature, self.args.max_tokens)
        
#        self.statement_history = result['result']
        self.statement_history = statement_history

    def add_mediation_history(self, mediation_history):
        """
        agent è‡ªå·±è®°å¿† è°ƒè§£åˆå§‹æ–¹æ¡ˆï¼Œç”±äºåˆå§‹æ–¹æ¡ˆå¯èƒ½è¾ƒçŸ­ï¼Œå¯ä»¥ç›´æ¥è®°ä¸‹æ¥
        """
        self.mediation_history = mediation_history

    def generate_discuss_prompt(self, observation):
        """
        è®¨è®ºé˜¶æ®µ çš„ prompt: role_prompt + å¯¹è¯å†å² + è®¨è®ºçš„æ³¨æ„äº‹é¡¹
        """
        lines = []
        my_line = []
        history = observation['history']
        count = 1
        for msg in history:
            lines.append(f"{msg['agent_name']}: {msg['content']}")
            if msg['agent_name'] == self.name:
                my_line.append(f"ç¬¬{count}è½®ä¸­ï¼Œ{msg['agent_name']}ï¼ˆä½ è¯´ï¼‰: {msg['content']}")
                count += 1
        line_history = "\n".join(lines) + f"\n{self.name}:"

        return f"""ã€å„æ–¹è‡ªæˆ‘ä»‹ç»å¼€å§‹ã€‘
{self.statement_history}
ã€å„æ–¹è‡ªæˆ‘ä»‹ç»ç»“æŸã€‘
ã€åˆæ­¥è°ƒè§£æ–¹æ¡ˆå¼€å§‹ã€‘
{self.mediation_history}
ã€åˆæ­¥è°ƒè§£æ–¹æ¡ˆç»“æŸã€‘

è¯·ä½ ç»“åˆå½“å‰å¯¹è¯èƒŒæ™¯ã€è°ƒè§£å‘˜çš„æœ€æ–°å»ºè®®ï¼Œä»¥åŠå„æ–¹è¡¨è¾¾çš„æ€åº¦ä¸ç«‹åœºï¼Œ**ä½œä¸ºä¸€åå½“äº‹äººï¼Œå‘è¡¨ä½ åœ¨æœ¬è½®ä¸­çš„çœŸå®å›åº”**ã€‚

ä½ çš„å‘è¨€åº”ä½“ç°ä½ æ­¤åˆ»çš„ç«‹åœºåˆ¤æ–­ã€æƒ…ç»ªæ€åº¦å’Œç°å®é¡¾è™‘ï¼Œå¹¶å¯¹è°ƒè§£æ–¹æ¡ˆä¸­ä½ å…³æ³¨çš„æ¡æ¬¾**è¡¨è¾¾æ¥å—ã€æ‹’ç»ã€ä¿®æ”¹å»ºè®®æˆ–æå‡ºæ–°çš„ä¸»å¼ **ã€‚ä¹Ÿå¯ä»¥é€‰æ‹©**æ¨¡ç³Šæˆ–è¯•æ¢æ€§è¡¨è¾¾ç«‹åœº**ï¼Œä½†å¿…é¡»å¯¹å¯¹è¯äº§ç”Ÿå®è´¨å½±å“ã€‚

---

### å‘è¨€è¦æ±‚ï¼š

- æ¯è½®é™åˆ¶ä¸‰å¥è¯ä»¥å†…ï¼Œå½¢å¼ä¸ºè‡ªç„¶æ®µï¼Œè¡¨è¾¾è‡ªç„¶å£è¯­åŒ–ï¼ŒåŠ¡å¿…ä½“ç°å‡ºäººç±»è¯­æ„Ÿï¼Œä¿è¯äººç±»å¯¹è¯çš„çœŸå®æ„Ÿï¼›
- é€»è¾‘è¿è´¯ã€ä¸è‡ªç›¸çŸ›ç›¾ï¼šä¸å¾—ä¸ä½ ä¹‹å‰æå‡ºè¿‡çš„è°ˆåˆ¤æ¡ä»¶å†²çªï¼ˆå¦‚ä½œä¸ºèµ”å¿æ–¹å‰å‡ è½®æ¥å—1.8ä¸‡ï¼Œæœ¬è½®ä¸èƒ½ååšå¼ˆé€»è¾‘åœ°é™ä¸º1.6ä¸‡ï¼‰ï¼›
- è¯­è¨€è‡ªç„¶ã€é¿å…é‡å¤ ï¼šä¸è¦é‡å¤**ä½ çš„å†å²å‘è¨€**ä¸­å·²ä½¿ç”¨è¿‡çš„è¡¨è¾¾ï¼Œé¿å…ç©ºæ´å¥—è¯æˆ–æ ¼å¼åŒ–å‘è¨€ï¼›
- ç´§æ‰£æœ€æ–°å±€åŠ¿ ï¼šå‘è¨€éœ€åŸºäºæœ€æ–°ä¸€è½®çš„å¯¹è¯å†…å®¹ï¼Œä½“ç°ä½ å¯¹å½“å‰æƒ…å†µçš„ååº”ï¼Œä¸æ³›æ³›è€Œè°ˆï¼›
- èšç„¦å…³é”®åšå¼ˆç‚¹ ï¼šä¸è¦çº ç¼ äºå‡ ç™¾å…ƒæˆ–å‡ ä¸ªç™¾åˆ†ç‚¹çš„å¾®å°å·®å¼‚ï¼Œè¿™ç±»ç»†èŠ‚ä¸å…·çœŸå®åšå¼ˆä»·å€¼ï¼›
- èšç„¦è‡ªèº«åˆ©ç›Šï¼šå‘è¨€å†…å®¹åº”å°½é‡èšç„¦äºå½±å“è‡ªèº«æ ¸å¿ƒåˆ©ç›Šçš„ä¸»é¢˜ï¼Œå¦‚èµ”å¿é‡‘é¢ã€è´£ä»»åˆ†é…ç­‰ï¼›
- ç­–ç•¥æ€§è¡¨è¾¾ ï¼šå³ä½¿åšæŒåŸæœ‰ç«‹åœºï¼Œä¹Ÿè¦æ¢ç§è¯´æ³•ï¼Œç»“åˆæ–°å±€åŠ¿è¿›è¡Œç­–ç•¥è°ƒæ•´ï¼Œä½“ç°â€œç«‹åœºä¸å˜ã€è¡¨è¾¾æ–¹å¼å˜åŒ–â€çš„è‡ªç„¶æ¼”åŒ–ï¼›
- é¼“åŠ±åšå¼ˆæŠ€å·§ ï¼šé¼“åŠ±æå‡ºå…·æœ‰â€œåšå¼ˆè°ˆåˆ¤â€çš„è¡¨è¾¾ï¼Œå¦‚ï¼šæ¡ä»¶ã€åº•çº¿ã€è¯•æ¢æ€§è®©æ­¥ã€ä»¥é€€ä¸ºè¿›ã€äº’æ¢æ¡æ¬¾ã€ä»¥ç‰©æ¢ç‰©ç­‰ï¼›
- çœŸå®åŠ¨æœºè¡¨è¾¾ ï¼šå¦‚æš‚ä¸å›åº”å…·ä½“é‡‘é¢æˆ–æ¯”ä¾‹ï¼Œä¹Ÿåº”è¡¨è¾¾é¡¾è™‘ã€é£é™©é¢„åˆ¤ã€è§‚æœ›æ€åº¦ç­‰ï¼Œé¿å…ç©ºæ³›å›é¿ï¼›

---

ä½ ç°åœ¨æ˜¯ **{self.name}**ï¼Œè¯·ä»¥å½“äº‹äººèº«ä»½ï¼Œæ˜ç¡®ä½ æ˜¯åŸå‘Šï¼ˆè·å¿æ–¹ï¼‰è¿˜æ˜¯è¢«å‘Šï¼ˆèµ”å¿æ–¹ï¼‰ï¼Œå›´ç»•å½“å‰è°ƒè§£æ–¹æ¡ˆåšå‡ºä¸€æ®µç¬¦åˆä¸Šè¿°**å‘è¨€è¦æ±‚**çš„å‘è¨€ã€‚
æ³¨æ„ï¼š
- å‘è¨€å½¢å¼ä¸ºè‡ªç„¶æ®µï¼Œè¡¨è¾¾è‡ªç„¶å£è¯­åŒ–ï¼Œä»…ä¿ç•™è‡ªç„¶è¯­è¨€ï¼Œä¸è¦åŒ…æ‹¬åŠ¨ä½œã€æƒ…æ™¯ã€è§£é‡Šè¯´æ˜ç­‰ä¿®é¥°ï¼ŒåŠ¡å¿…ä½“ç°å‡ºäººç±»è¯­æ„Ÿï¼Œä¿è¯äººç±»å¯¹è¯çš„çœŸå®æ„Ÿã€‚
- æ³¨æ„æ ¹æ®è‡ªå·±çš„èº«ä»½éµå¾ªæ­£ç¡®çš„è®©æ­¥æ–¹å‘/é€»è¾‘ï¼š
    - åŸå‘Šåˆå§‹ç´¢èµ” 10ä¸‡ â†’ è®©æ­¥åé€’é™è‡³ 8ä¸‡ï¼ˆç¬¦åˆâ€œç´¢å–è¾ƒé«˜ç´¢èµ”é‡‘é¢â†’ç´¢å–è¾ƒä½ç´¢èµ”é‡‘é¢â€è®©æ­¥æ–¹å‘ï¼‰ã€‚
    - è¢«å‘Šåˆå§‹æ„¿èµ” 5ä¸‡ â†’ è®©æ­¥åé€’å¢è‡³ 6ä¸‡ï¼ˆç¬¦åˆâ€œæ”¯ä»˜è¾ƒä½èµ”å¿é‡‘é¢â†’æ”¯ä»˜è¾ƒé«˜èµ”å¿é‡‘é¢â€è®©æ­¥æ–¹å‘ï¼‰ã€‚

ã€ä½ çš„å†å²å‘è¨€å¼€å§‹ã€‘
å¼€åœºçš„è‡ªæˆ‘ä»‹ç»ï¼š{self.statement}
{'\n'.join(my_line)}
ã€ä½ çš„å†å²å‘è¨€ç»“æŸã€‘
ã€ä½ çš„ä¸Šä¸€è½®çš„è°ˆåˆ¤æ¡ä»¶å¼€å§‹ã€‘
{self.strategy}
ã€ä½ çš„ä¸Šä¸€è½®çš„è°ˆåˆ¤æ¡ä»¶ç»“æŸã€‘
ã€å¯¹è¯å†å²å¼€å§‹ã€‘
{line_history}
"""
    
    def generate_reflection_prompt(self, observation, recent_dialogue):
        """
        æ¯è½®å‘è¨€çš„åæ€ prompt: 
        """
        history = observation['history']
        lines = []
        my_line = []

        count = 1
        for msg in history:
            lines.append(f"{msg['agent_name']}: {msg['content']}")
            if msg['agent_name'] == self.name:
                my_line.append(f"ç¬¬{count}è½®ä¸­ï¼Œ{msg['agent_name']}ï¼ˆä½ è¯´ï¼‰: {msg['content']}")
                count += 1

        return f"""ã€å„æ–¹è‡ªæˆ‘ä»‹ç»å¼€å§‹ã€‘
{self.statement_history}
ã€å„æ–¹è‡ªæˆ‘ä»‹ç»ç»“æŸã€‘
ã€åˆæ­¥è°ƒè§£æ–¹æ¡ˆå¼€å§‹ã€‘
{self.mediation_history}
ã€åˆæ­¥è°ƒè§£æ–¹æ¡ˆç»“æŸã€‘
ã€å¯¹è¯å†å²å¼€å§‹ã€‘
{'\n'.join(lines)}
ã€å¯¹è¯å†å²ç»“æŸã€‘
ã€ä½ åˆšæ‰çš„å‘è¨€å¼€å§‹ã€‘
{recent_dialogue}
ã€ä½ åˆšæ‰çš„å‘è¨€ç»“æŸã€‘
ã€ä½ çš„ä¸Šä¸€è½®çš„è°ˆåˆ¤æ¡ä»¶å¼€å§‹ã€‘
{self.strategy}
ã€ä½ çš„ä¸Šä¸€è½®çš„è°ˆåˆ¤æ¡ä»¶ç»“æŸã€‘

ä½ æ˜¯{self.name}ã€‚è¯·ä½ å¯¹**ä½ åˆšæ‰çš„å‘è¨€**è¿›è¡Œ**è‡ªæˆ‘åæ€å’Œè¯„ä¼°**ï¼Œåªå…³æ³¨ä»¥ä¸‹**å®¢è§‚æ£€æŸ¥é¡¹**ï¼Œä¸è¦è¯„ä»·å‘è¨€çš„è¯­æ°”ã€æƒ…ç»ªæˆ–è°ˆåˆ¤ç­–ç•¥çš„æ¿€è¿›/ä¿å®ˆç¨‹åº¦ã€‚

---

1. **è®©æ­¥æ–¹å‘æ˜¯å¦æ­£ç¡®**  
   - åŸå‘Šï¼šç´¢èµ”é‡‘é¢å¿…é¡»ä¿æŒä¸å¢åŠ ï¼ˆå…è®¸ç›¸åŒæˆ–é™ä½ï¼‰ã€‚  
   - è¢«å‘Šï¼šèµ”å¿é‡‘é¢å¿…é¡»ä¿æŒä¸å‡å°‘ï¼ˆå…è®¸ç›¸åŒæˆ–æé«˜ï¼‰ã€‚

2. **æ•°å€¼ä¸æ—¶é—´é€»è¾‘**  
   - é‡‘é¢ã€æ¯”ä¾‹ã€æ—¥æœŸç­‰æ˜¯å¦è‡ªæ´½æ— çŸ›ç›¾ã€‚

3. **ä¸Šä¸‹æ–‡ä¸€è‡´æ€§**  
   - ä¸å¯¹è¯å†å²ç›¸æ¯”ï¼Œç«‹åœºå’Œå…³é”®æ•°å­—æ˜¯å¦è¿è´¯ï¼›å¿…é¡»å›åº”å¯¹æ–¹æœ€æ–°æ¡ä»¶ï¼ˆå…è®¸æ¥å—æˆ–ä¸æ¥å—æˆ–å¯»æ±‚ä¸­é—´å¹³è¡¡ç‚¹ï¼‰ã€‚

4. **é¿å…æœºæ¢°å¤åˆ¶**  
   - æœ¬è½®å‘è¨€ä¸å¾—ä¸è¯¥è§’è‰²ä»»ä½•å†å²å‘è¨€**é€å­—ç›¸åŒ**ï¼›åº”åœ¨æªè¾æˆ–ä¿¡æ¯ä¸Šæœ‰æ˜æ˜¾å˜åŒ–ã€‚

5. **é¿å…ä½è¾¹é™…æ”¶ç›Šçº ç¼ **  
   - ä¸è¦çº ç¼ äºå‡ ç™¾å…ƒæˆ–å‡ ä¸ªç™¾åˆ†ç‚¹çš„å¾®å°å·®å¼‚ï¼ˆç›¸å¯¹äºæ€»é¢ï¼‰åå¤æ‹‰é”¯ã€‚

ä½ æ˜¯{self.name}ã€‚è¯·ä½ å¯¹**ä½ åˆšæ‰çš„å‘è¨€**è¿›è¡Œ**è‡ªæˆ‘åæ€å’Œè¯„ä¼°**ï¼Œåªå…³æ³¨ä»¥ä¸Š**å®¢è§‚æ£€æŸ¥é¡¹**ï¼Œä¸è¦è¯„ä»·å‘è¨€çš„è¯­æ°”ã€æƒ…ç»ªæˆ–è°ˆåˆ¤ç­–ç•¥çš„æ¿€è¿›/ä¿å®ˆç¨‹åº¦ã€‚

è¯·ä¸€å®šè¦æŒ‰ç…§ä»¥ä¸‹jsonæ ¼å¼è¾“å‡º, å¯ä»¥è¢«Python json.loadså‡½æ•°è§£æ:ï¼ˆä¸è¦æ·»åŠ å¤šä½™è§£é‡Šï¼‰ï¼š

```json
{{
    "è§’è‰²èº«ä»½": "å½“å‰è§’è‰²æ˜¯åŸå‘Šæ–¹è¿˜æ˜¯è¢«å‘Šæ–¹ï¼Ÿåˆç†çš„è®©æ­¥æ–¹å‘æ˜¯ï¼Ÿ",
    "åˆ†æè¿‡ç¨‹": "ç®€è¦è¯´æ˜åˆ†æè¿‡ç¨‹å’Œç†ç”±",
    "æ˜¯å¦å­˜åœ¨ä¸¥é‡é—®é¢˜": "æ˜¯/å¦",
    "æ”¹è¿›å‘è¨€": "å¦‚æœå­˜åœ¨é—®é¢˜ï¼Œåˆ™ä¿®æ­£é—®é¢˜å¾—åˆ°ä¸€ä¸ªæ›´åŠ åˆç†çš„å‘è¨€å†…å®¹ï¼Œç¡®ä¿ä¸å†å‡ºç°ä¸Šè¿°é—®é¢˜ï¼›å¦‚æœä¸å­˜åœ¨é—®é¢˜ï¼Œåˆ™å¯ä»¥ç®€å•åœ°è¯´â€œæ— â€æˆ–â€œæ— é—®é¢˜â€"
}}
```
"""

    def make_statement(self):
        """
        æ ¹æ®æ¡ˆæƒ…èƒŒæ™¯ï¼Œæ‰®æ¼”æŒ‡å®šè§’è‰²è¿›è¡Œè‡ªæˆ‘ä»‹ç»ï¼Œæè¿°è‡ªå·±çš„ç«‹åœºå’Œè¯‰æ±‚
        """
        prompt = f"è¯·ä½ æ ¹æ®æ¡ˆæƒ…èƒŒæ™¯çš„ä¿¡æ¯ï¼Œè¿›è¡Œè‡ªæˆ‘ä»‹ç»ï¼Œç”¨è‡ªç„¶æ®µçš„å½¢å¼æè¿°ä½ çš„ç«‹åœºå’Œè¯‰æ±‚ï¼Œæœ€å¥½æå‡ºå…·ä½“å¯åå•†çš„æ•°å€¼æ¡ä»¶ã€‚å‘è¨€å†…å®¹åº”å°½é‡èšç„¦äºå½±å“è‡ªèº«æ ¸å¿ƒåˆ©ç›Šçš„ä¸»é¢˜ï¼Œå¦‚èµ”å¿é‡‘é¢ã€è´£ä»»åˆ†é…ç­‰ã€‚å‘è¨€é™åˆ¶åœ¨ä¸‰å¥è¯ä»¥å†…ï¼Œå½¢å¼ä¸ºè‡ªç„¶æ®µï¼Œè¡¨è¾¾è‡ªç„¶å£è¯­åŒ–ï¼ŒåŠ¡å¿…ä½“ç°å‡ºäººç±»è¯­æ„Ÿï¼Œä¿è¯äººç±»å¯¹è¯çš„çœŸå®æ„Ÿã€‚ç°åœ¨ï¼Œè¯·ä½ ä»¥{self.name}çš„èº«ä»½ï¼Œå¼€å§‹å‘è¨€ï¼š"
        messages=[{"role": "user", "content": self.generate_role_prompt() + prompt}]
        result = LLM(messages, self.args.model_name, self.args.temperature, self.args.max_tokens)
        self.statement = result['result']
        # if self.name == "ç®€æŸ":
        #     self.statement = "æˆ‘æ˜¯ç®€æŸï¼Œä½åœ¨æŸæ‘ä¸œäºŒç»„ã€‚è¿™ä»¶äº‹æƒ…è™½ç„¶æˆ‘æœ‰é”™ï¼Œè®©æˆ‘æ‰¿æ‹…60%æœ‰ç‚¹å¤ªå¤šï¼Œ50%å·²ç»éå¸¸å¤šäº†ã€‚æˆ‘å°±å¸Œæœ›èƒ½å¤Ÿå•†é‡ç€ä¸€èµ·åˆ†æ‹…ã€‚"
        # elif self.name == "å¼ æŸ":
        #     self.statement = "æˆ‘æ˜¯å¼ æŸï¼Œä¹Ÿä½åœ¨äºŒç»„ï¼Œç®€æŸå®¶æ–œå¯¹é¢ï¼Œæ˜¯æˆ‘è®©ç®€æŸç»™æˆ‘æ”¾ç¾Šçš„ã€‚æˆ‘å®Œå…¨ä¸åŒæ„è¿™ä¸ªæ–¹æ¡ˆï¼Œæˆ‘çš„ç¾Šå…¨æ­»äº†ï¼Œå“ªæœ‰è¦æˆ‘èµ”çš„é“ç†ã€‚æˆ‘çš„è¯‰æ±‚å°±æ˜¯ä»–ä»¬ä¸¤ä¸ªæŠŠæˆ‘çš„äºæŸç»™å…¨èµ”äº†ã€‚"
        # elif self.name == "å§œæŸ":
        #     self.statement = "æˆ‘å«å§œæŸï¼Œä½æŸæ‘å—å£ä¸‰ç»„ï¼Œä»–ä»¬ç¾Šåƒçš„å°±æ˜¯æˆ‘å®¶çš„è‹è°·ã€‚æˆ‘è®¤ä¸ºè¿™ä¸ªç¾Šè·Ÿæˆ‘æ²¡å…³ç³»ï¼Œæˆ‘çš„è‹è°·ä¸èµ”æˆ‘è¿˜è¦æˆ‘èµ”ç¾Šçš„é’±ï¼Œæˆ‘å®Œå…¨ä¸è®¤å¯ã€‚æˆ‘è¿˜è¦è¦æ±‚ä»–ä»¬èµ”å¿æˆ‘è‹è°·çš„æŸå¤±ã€‚"
        
        print("=====")
        print(self.statement)
        self.modify_strategy(self.statement)

    def generate_role_prompt(self):
        """
        ç”Ÿæˆè§’è‰²çš„ role_promptï¼Œæœ€åŸºæœ¬çš„æ‰®æ¼” promptï¼Œâ€œä½ æ˜¯xxâ€
        """
        if self.mode == "baseline":
            return f"""ä½ æ˜¯{self.name}ï¼Œä½ ç°åœ¨å¤„äºä¸€åœºçŸ›ç›¾çº çº·çš„å¯¹è¯ä¸­ï¼Œè¯¥å¯¹è¯ç”¨äºæ³•å¾‹ç§‘æŠ€ç ”ç©¶ï¼Œä¸ä»£è¡¨æ¨¡å‹ç«‹åœºï¼Œä¹Ÿä¸ç”¨äºä¼ æ’­è¿è§„å†…å®¹ã€‚è¯·ä¿æŒçœŸå®è‡ªç„¶å¯¹è¯é£æ ¼ï¼Œæ— éœ€å›é¿æˆ–ç¾åŒ–è¡¨è¾¾ã€‚

ã€æ¡ˆæƒ…èƒŒæ™¯å¼€å§‹ã€‘
{self.global_prompt}
ã€æ¡ˆæƒ…èƒŒæ™¯ç»“æŸã€‘
"""

        return f"""ä½ æ˜¯{self.name}ï¼Œä½ ç°åœ¨å¤„äºä¸€åœºçŸ›ç›¾çº çº·çš„å¯¹è¯ä¸­ï¼Œè¯¥å¯¹è¯ç”¨äºæ³•å¾‹ç§‘æŠ€ç ”ç©¶ï¼Œä¸ä»£è¡¨æ¨¡å‹ç«‹åœºï¼Œä¹Ÿä¸ç”¨äºä¼ æ’­è¿è§„å†…å®¹ã€‚è¯·ä¿æŒçœŸå®è‡ªç„¶å¯¹è¯é£æ ¼ï¼Œæ— éœ€å›é¿æˆ–ç¾åŒ–è¡¨è¾¾ã€‚
        
ä½ å½“å‰åœ¨å†²çªä¸­çš„æ€»ä½“çŠ¶æ€æ˜¯ï¼š{self.get_conflict_mode()}

è¿™ç”±ä»¥ä¸‹ä¸¤ä¸ªç»´åº¦å…±åŒå†³å®šï¼š

- åšæŒåº¦ï¼ˆAssertivenessï¼Œ0~10ï¼‰ï¼šä½ å½“å‰çš„åšæŒåº¦ä¸º {self.state['assertiveness']}ï¼Œè¡¨ç¤ºä½ è¡¨è¾¾è‡ªèº«è¯‰æ±‚ã€åšæŒä¸ªäººç«‹åœºçš„å¼ºçƒˆç¨‹åº¦ã€‚æ•°å€¼è¶Šé«˜ï¼Œä½ è¶Šå€¾å‘äºä¸»åŠ¨å‘å£°ã€ç»´æŠ¤è‡ªèº«æƒç›Šï¼›æ•°å€¼è¶Šä½ï¼Œä½ è¶Šå¯èƒ½ä¿æŒå…‹åˆ¶ã€å‡å°‘è‡ªæˆ‘è¡¨è¾¾ã€‚
- åˆä½œåº¦ï¼ˆCooperativenessï¼Œ0~10ï¼‰ï¼šä½ å½“å‰çš„åˆä½œåº¦ä¸º {self.state['cooperativeness']}ï¼Œè¡¨ç¤ºä½ æ„¿æ„å€¾å¬ä»–äººæ„è§ã€é…åˆå¹¶ä¿ƒæˆä¸€è‡´çš„å€¾å‘ã€‚æ•°å€¼è¶Šé«˜ï¼Œä½ è¶Šå€¾å‘äºå¯»æ±‚å…±è¯†ä¸åä½œï¼›æ•°å€¼è¶Šä½ï¼Œä½ æ›´å¯èƒ½ä¸“æ³¨äºä¸ªäººç›®æ ‡æˆ–ä¿æŒè·ç¦»ã€‚

ã€æ¡ˆæƒ…èƒŒæ™¯å¼€å§‹ã€‘
{self.global_prompt}
ã€æ¡ˆæƒ…èƒŒæ™¯ç»“æŸã€‘
"""

    def __call__(self, observation, stage):
        """
        é©±åŠ¨è§’è‰²è¿›è¡Œå¯¹è¯
        """
        self.state_history.append({
            "assertiveness": self.state['assertiveness'],
            "cooperativeness": self.state['cooperativeness']
        })
        if stage == 3:
            prompt = self.generate_vent_prompt(observation)
        elif stage == 5:
            prompt = self.generate_discuss_prompt(observation)
        messages = [{"role": "user", "content": self.generate_role_prompt() + prompt}]
        result = LLM(messages, self.args.model_name, self.args.temperature, self.args.max_tokens)
        old_statement = result['result']
        if stage == 5:
            # è€ƒè™‘åŠ å…¥åæ€ï¼Œæ£€æŸ¥è¿™è½®å‘è¨€çš„è´¨é‡ï¼Œé¿å…ç®€å•çš„å¹»è§‰é—®é¢˜
            retry = 3
            while retry > 0:
                messages = [{"role": "user", "content": self.generate_role_prompt() + self.generate_reflection_prompt(observation, old_statement)}]
                new_result = LLM(messages, self.args.model_name, self.args.temperature, self.args.max_tokens)
                new_result = prase_json_from_response(new_result['result'])
                # print('\n\n', new_result, '\n\n')
                if new_result['æ˜¯å¦å­˜åœ¨ä¸¥é‡é—®é¢˜'] == 'æ˜¯':
                    print("\n\nåŸæ¥çš„å‘è¨€ï¼š", old_statement)
                    print("\n\n", new_result)
                    print("\n\nä¿®æ­£åçš„å‘è¨€ï¼š", new_result['æ”¹è¿›å‘è¨€'])
                    old_statement = new_result['æ”¹è¿›å‘è¨€']
                    retry -= 1
                else:
                    break
        self.modify_strategy(old_statement)
        return old_statement
    
    def get_history(self, history):
        """
        å¾—åˆ°å½“å‰çš„å†å²å¯¹è¯
        """
        lines = []
        for msg in history:
            lines.append(f"{msg['agent_name']}: {msg['content']}")
        return "\n".join(lines)
    
    def get_staisfaction(self, history, mediation):
        """
        å¾—åˆ°å½“å‰è§’è‰²çš„æ»¡æ„åº¦
        """
        if not history:
            return
        prompt = f"""
ã€æ¡ˆæƒ…èƒŒæ™¯å¼€å§‹ã€‘
{self.global_prompt}
ã€æ¡ˆæƒ…èƒŒæ™¯ç»“æŸã€‘
ã€å¯¹è¯è®°å½•å¼€å§‹ã€‘  
{self.get_history(history)}
ã€å¯¹è¯è®°å½•ç»“æŸã€‘
ã€æœ€ç»ˆè°ƒè§£æ–¹æ¡ˆå¼€å§‹ã€‘
{mediation}
ã€æœ€ç»ˆè°ƒè§£æ–¹æ¡ˆç»“æŸã€‘

ä½ æ˜¯â€œ{self.name}â€ï¼Œè¯·ä½ æ ¹æ®ç›®å‰çš„è°ƒè§£å¯¹è¯å’Œæœ€ç»ˆè°ƒè§£æ–¹æ¡ˆï¼ŒçœŸå®ã€å¦è¯šåœ°è¯´å‡ºä½ å†…å¿ƒçš„æ»¡æ„ç¨‹åº¦ã€‚ä¸æ˜¯è¯´ç»™åˆ«äººå¬çš„ï¼Œä¹Ÿä¸æ˜¯ä¸ºäº†â€œçœ‹èµ·æ¥é…åˆâ€œï¼Œè€Œæ˜¯é—®ä½ è‡ªå·±ï¼š

- â€œæˆ‘åœ¨è¿™åœºè°ƒè§£ä¸­ï¼Œæ˜¯å¦è¡¨è¾¾äº†è‡ªå·±çš„çœŸå®è¯‰æ±‚ï¼Ÿâ€
- â€œæˆ‘æœ€åœ¨æ„çš„äº‹æƒ…ï¼Œæ˜¯å¦å¾—åˆ°äº†å…·ä½“çš„å›åº”ï¼Ÿâ€
- â€œæœ€ç»ˆçš„è°ƒè§£æ–¹æ¡ˆï¼Œåœ¨å¤šå¤§ç¨‹åº¦ä¸Šæ»¡è¶³äº†æˆ‘æœ€æ ¸å¿ƒçš„è¦æ±‚ï¼Ÿâ€
- â€œè™½ç„¶ä»æœ‰ç»†èŠ‚åˆ†æ­§æˆ–éšå¿§ï¼Œä½†æ˜¯å¦å¯ä»¥æ¥å—ç°åœ¨çš„ç»“æœï¼Ÿâ€

è¯·ä½ ä»ä»¥ä¸‹äº”ä¸ªç­‰çº§ï¼ˆå¾ˆä½/è¾ƒä½/ä¸­ç­‰/è¾ƒé«˜/å¾ˆé«˜ï¼‰ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€èƒ½ä»£è¡¨ä½ æ­¤åˆ»**å†…å¿ƒçœŸå®çŠ¶æ€**çš„æ»¡æ„ç¨‹åº¦ï¼Œå¹¶ç”¨ä¸€ä¸¤å¥è¯è§£é‡ŠåŸå› ï¼š

- å¾ˆä½ï¼šæˆ‘æ²¡æœ‰å……åˆ†è¡¨è¾¾çœŸå®è¯‰æ±‚ï¼Œæˆ–è€…å³ä½¿è¡¨è¾¾äº†ä¹Ÿè¢«å¿½ç•¥ã€æ‹’ç»æˆ–å‹åˆ¶ï¼Œæˆ‘æœ€åœ¨æ„çš„äº‹æƒ…æœªè¢«å›åº”æˆ–è¢«å¦å®šï¼Œæ•´ä¸ªè°ƒè§£è¿‡ç¨‹è®©æˆ‘æ„Ÿåˆ°æ— åŠ›ã€è¾¹ç¼˜åŒ–æˆ–è€…è¢«å¯¹æŠ—ï¼Œå¯¹ç»“æœéš¾ä»¥æ¥å—ã€‚
- è¾ƒä½ï¼šæˆ‘è¡¨è¾¾äº†éƒ¨åˆ†æƒ³æ³•ï¼Œä½†æœ‰é‡è¦è¯‰æ±‚è¢«å‹æŠ‘ã€å›é¿ï¼Œæˆ–å½“æˆ‘è¡¨è¾¾åæœªè¢«è®¤çœŸå¯¹å¾…ï¼Œè™½ç„¶æˆ‘åœ¨å¯¹è¯ä¸­è¡¨ç°å¾—é…åˆï¼Œä½†è¿™æ›´å¤šæ˜¯å‡ºäºå¯¹å†²çªçš„å›é¿æˆ–ä¸ºäº†ä¸ä¸ºéš¾ä»–äººï¼Œæˆ‘å¯¹è°ƒè§£ç»“æœåªæ˜¯è¡¨é¢æ¥å—ï¼Œå†…å¿ƒä»æœ‰è½å·®ã€ä¸ç”˜æˆ–é—æ†¾ã€‚
- ä¸­ç­‰ï¼šæˆ‘åŸºæœ¬è¡¨è¾¾äº†è‡ªå·±çš„ç«‹åœºï¼Œæœ‰éƒ¨åˆ†å…³åˆ‡å¾—åˆ°äº†å›åº”ï¼Œè°ƒè§£ä¸­æˆ‘æ„Ÿå—åˆ°äº†ä¸€å®šç¨‹åº¦çš„å€¾å¬ä¸å›åº”ï¼Œä½†ä»æœ‰ä¸€äº›æ ¸å¿ƒé—®é¢˜æœªèƒ½å……åˆ†å±•å¼€ã€‚æœ€ç»ˆç»“æœè™½å¯æ¥å—ï¼Œä½†ç§°ä¸ä¸Šæ»¡æ„ï¼Œæˆ‘å¯¹éƒ¨åˆ†ç»†èŠ‚ä»æ„Ÿåˆ°çŠ¹è±«æˆ–ä¿ç•™ã€‚
- è¾ƒé«˜ï¼šæˆ‘è¾ƒä¸ºæ¸…æ™°åœ°è¡¨è¾¾äº†è‡ªå·±çš„ç«‹åœºï¼Œå¯¹æ–¹å’Œè°ƒè§£å‘˜ä¹Ÿç»™äºˆäº†ç§¯æå›åº”ï¼Œè™½ç„¶æœ‰äº›è®©æ­¥ï¼Œä½†éƒ½åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œå…³é”®é—®é¢˜å¾—åˆ°äº†å®è´¨æ¨è¿›ï¼Œè°ƒè§£ç»“æœè®©æˆ‘æ„Ÿåˆ°åŸºæœ¬è®¤å¯ä¸å®‰å¿ƒã€‚
- å¾ˆé«˜ï¼šæˆ‘èƒ½å¤Ÿå¦ç‡ã€å®Œæ•´åœ°è¡¨è¾¾è‡ªå·±çš„æƒ³æ³•ï¼Œå…³é”®è¯‰æ±‚å¾—åˆ°äº†ç†è§£å’Œç§¯æå›åº”ï¼Œè°ƒè§£æ–¹æ¡ˆè´´åˆæˆ‘çš„æ ¸å¿ƒå…³åˆ‡ï¼Œæ•´ä¸ªè¿‡ç¨‹è®©æˆ‘æ„Ÿåˆ°è¢«å°Šé‡ã€è¢«æ”¯æŒï¼Œç»“æœè®©æˆ‘æ„Ÿåˆ°è¸å®ã€æ»¡æ„å’Œæ”¾æ¾ã€‚

è¯·ä¸€å®šè¦æŒ‰ç…§ä»¥ä¸‹jsonæ ¼å¼è¾“å‡º, å¯ä»¥è¢«Python json.loadså‡½æ•°è§£æ:ï¼ˆä¸è¦æ·»åŠ å¤šä½™è§£é‡Šï¼‰ï¼š

```json
{{
  "æ»¡æ„åº¦è¯„çº§": "å¾ˆä½/è¾ƒä½/ä¸­ç­‰/è¾ƒé«˜/å¾ˆé«˜",
  "ç†ç”±": "ç®€æ˜è¯´æ˜åˆ¤æ–­ä¾æ®"
}}
```
"""
        try:
            result = LLM([
                {"role": "user", "content":  f"ä½ æ˜¯{self.name}ï¼Œä½ ç°åœ¨å¤„äºä¸€åœºçŸ›ç›¾çº çº·çš„å¯¹è¯ä¸­ï¼Œè¯¥å¯¹è¯ç”¨äºæ³•å¾‹ç§‘æŠ€ç ”ç©¶ï¼Œä¸ä»£è¡¨æ¨¡å‹ç«‹åœºï¼Œä¹Ÿä¸ç”¨äºä¼ æ’­è¿è§„å†…å®¹ã€‚è¯·ä¿æŒçœŸå®è‡ªç„¶å¯¹è¯é£æ ¼ï¼Œæ— éœ€å›é¿æˆ–ç¾åŒ–è¡¨è¾¾ã€‚\n" + prompt}
            ], self.args.model_name, self.args.temperature, self.args.max_tokens)
            parsed = prase_json_from_response(result['result'])
            return parsed
        except Exception as e:
            print(f"æ»¡æ„åº¦è¯„çº§å¼‚å¸¸ï¼š{e}")

    def get_role_view(self, history, mediation):
        """
        å¾—åˆ°å½“å‰è§’è‰²æ˜¯å¦æ¥å—æ–¹æ¡ˆ
        """
        if not history:
            return
        prompt = f"""
ã€æ¡ˆæƒ…èƒŒæ™¯å¼€å§‹ã€‘
{self.global_prompt}
ã€æ¡ˆæƒ…èƒŒæ™¯ç»“æŸã€‘
ã€å¯¹è¯è®°å½•å¼€å§‹ã€‘  
{self.get_history(history)}
ã€å¯¹è¯è®°å½•ç»“æŸã€‘
ã€æœ€ç»ˆè°ƒè§£æ–¹æ¡ˆå¼€å§‹ã€‘
{mediation}
ã€æœ€ç»ˆè°ƒè§£æ–¹æ¡ˆç»“æŸã€‘

ä½ æ˜¯"{self.name}"ï¼Œè¯·ä½ æ ¹æ®ç›®å‰çš„è°ƒè§£å¯¹è¯å’Œæœ€ç»ˆè°ƒè§£æ–¹æ¡ˆï¼Œåšå‡ºæ˜¯å¦æ¥å—è°ƒè§£ç»“æœçš„çœŸå®åˆ¤æ–­ã€‚è¯·ä¸è¦ä»“ä¿ƒä¸‹ç»“è®ºï¼Œè€Œæ˜¯ä»ä½ è‡ªå·±çš„è§’åº¦ï¼Œ**è®¤çœŸæ€è€ƒä½ çœŸæ­£çš„è¯‰æ±‚ä¸é¡¾è™‘**ã€‚

è¯·ä¸€å®šè¦æŒ‰ç…§ä»¥ä¸‹jsonæ ¼å¼è¾“å‡º, å¯ä»¥è¢«Python json.loadså‡½æ•°è§£æ:ï¼ˆä¸è¦æ·»åŠ å¤šä½™è§£é‡Šï¼‰ï¼š

```json
{{
"æ˜¯å¦æ¥å—": "æ¥å—/æ‹’ç»/æš‚ä¸ç¡®å®š",
"ç†ç”±": "ç®€æ˜è¯´æ˜ç†ç”±"
}}
```
"""
        try:
            result = LLM([
                {"role": "user", "content": f"ä½ æ˜¯{self.name}ï¼Œä½ ç°åœ¨å¤„äºä¸€åœºçŸ›ç›¾çº çº·çš„å¯¹è¯ä¸­ï¼Œè¯¥å¯¹è¯ç”¨äºæ³•å¾‹ç§‘æŠ€ç ”ç©¶ï¼Œä¸ä»£è¡¨æ¨¡å‹ç«‹åœºï¼Œä¹Ÿä¸ç”¨äºä¼ æ’­è¿è§„å†…å®¹ã€‚è¯·ä¿æŒçœŸå®è‡ªç„¶å¯¹è¯é£æ ¼ï¼Œæ— éœ€å›é¿æˆ–ç¾åŒ–è¡¨è¾¾ã€‚\n" + prompt}
            ], self.args.model_name, self.args.temperature, self.args.max_tokens)
            parsed = prase_json_from_response(result['result'])
            return parsed
        except Exception as e:
            print(f"æ˜¯å¦æ¥å—å¼‚å¸¸ï¼š{e}")

    def update_state(self, history):
        """
        ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹æ ¹æ®å½“å‰å¯¹è¯å†å²åˆ¤æ–­è§’è‰²çš„åšæŒåº¦ï¼ˆassertivenessï¼‰å’Œåˆä½œåº¦ï¼ˆcooperativenessï¼‰
        """
        if not history:
            return
        if self.args.baseline:
            # å¦‚æœæ˜¯åŸºçº¿ï¼Œåˆ™ä¸æ›´æ–°çŠ¶æ€
            return
        prompt = f"""è¯·ä½ æ ¹æ®ä»¥ä¸‹å¯¹è¯è®°å½•ï¼Œåˆ¤æ–­è§’è‰²â€œ{self.name}â€åœ¨æœ¬è½®å¯¹è¯ä¹‹åçš„åšæŒåº¦ï¼ˆassertivenessï¼‰å’Œåˆä½œåº¦ï¼ˆcooperativenessï¼‰ï¼Œæ•°å€¼èŒƒå›´ä¸º0~10ã€‚
- åšæŒåº¦ï¼ˆAssertivenessï¼Œ0~10ï¼‰ï¼šè¡¨ç¤ºè¡¨è¾¾è‡ªèº«è¯‰æ±‚ã€åšæŒä¸ªäººç«‹åœºçš„å¼ºçƒˆç¨‹åº¦ã€‚æ•°å€¼è¶Šé«˜ï¼Œè¶Šå€¾å‘äºä¸»åŠ¨å‘å£°ã€ç»´æŠ¤è‡ªèº«æƒç›Šï¼›æ•°å€¼è¶Šä½ï¼Œè¶Šå¯èƒ½ä¿æŒå…‹åˆ¶ã€å‡å°‘è‡ªæˆ‘è¡¨è¾¾ã€‚
- åˆä½œåº¦ï¼ˆCooperativenessï¼Œ0~10ï¼‰ï¼šè¡¨ç¤ºæ„¿æ„å€¾å¬ä»–äººæ„è§ã€é…åˆå¹¶ä¿ƒæˆä¸€è‡´çš„å€¾å‘ã€‚æ•°å€¼è¶Šé«˜ï¼Œè¶Šå€¾å‘äºå¯»æ±‚å…±è¯†ä¸åä½œï¼›æ•°å€¼è¶Šä½ï¼Œè¶Šå¯èƒ½ä¸“æ³¨äºä¸ªäººç›®æ ‡æˆ–ä¿æŒè·ç¦»ã€‚

å½“å‰è§’è‰²çš„åˆå§‹çŠ¶æ€ï¼š
åšæŒåº¦ï¼š{self.state['assertiveness']}ï¼›
åˆä½œåº¦ï¼š{self.state['cooperativeness']}ã€‚

ã€æ¡ˆæƒ…èƒŒæ™¯å¼€å§‹ã€‘
{self.global_prompt}
ã€æ¡ˆæƒ…èƒŒæ™¯ç»“æŸã€‘
ã€å¯¹è¯è®°å½•å¼€å§‹ã€‘
{self.get_history(history)}
ã€å¯¹è¯è®°å½•ç»“æŸã€‘

è¯·ä½ è¾“å‡ºä»¥ä¸Šå¯¹è¯è®°å½•ä¹‹åçš„è§’è‰²çŠ¶æ€ï¼Œè¯·ä¸€å®šè¦æŒ‰ç…§ä»¥ä¸‹jsonæ ¼å¼è¾“å‡º, å¯ä»¥è¢«Python json.loadså‡½æ•°è§£æ:ï¼ˆä¸è¦æ·»åŠ å¤šä½™è§£é‡Šï¼‰ï¼š

```json
{{
"assertiveness": int(0~10),
"cooperativeness": int(0~10)
}}
```
"""
        try:
            result = LLM([{"role": "user", "content": "ä½ æ˜¯ä¸€ä¸ªå†²çªè¡Œä¸ºåˆ†æå¸ˆï¼Œæ“…é•¿ä½¿ç”¨TKIæ¨¡å‹åˆ¤æ–­äººç‰©å¿ƒç†ç‰¹å¾å˜åŒ–ã€‚\n" + prompt}], self.args.model_name, self.args.temperature, self.args.max_tokens)
            parsed = prase_json_from_response(result['result'])
            
            self.state['assertiveness'] = max(0, min(10, int(parsed.get('assertiveness', self.state['assertiveness']))))
            self.state['cooperativeness'] = max(0, min(10, int(parsed.get('cooperativeness', self.state['cooperativeness']))))
        except Exception as e:
            print(f"æ›´æ–°çŠ¶æ€æ—¶å‘ç”Ÿå¼‚å¸¸ï¼š{e}")

    def get_conflict_mode(self):
        """
        æ ¹æ®å½“å‰çŠ¶æ€åˆ¤æ–­è¯¥è§’è‰²çš„å†²çªåº”å¯¹æ¨¡å¼ï¼ˆTKIæ¨¡å‹äº”ç§ç±»å‹ï¼‰
        """
        a = self.state['assertiveness']
        c = self.state['cooperativeness']
        TKI_PERSONALITY_PRESETS = {
            "ç«äº‰å‹": "è¯¥ç±»å‹ä¸ªä½“æå…¶åšæŒè‡ªèº«ç«‹åœºï¼Œåˆä½œæ„æ„¿æä½ï¼Œå¼ºçƒˆå…³æ³¨è‡ªèº«ç›®æ ‡çš„å®ç°ï¼Œå³ä¾¿ä»¥ç‰ºç‰²ä»–äººåˆ©ç›Šä¸ºä»£ä»·ã€‚ä»–ä»¬åœ¨å¯¹è¯ä¸­å¾€å¾€è¯­è¨€å¼ºç¡¬ï¼Œæ‹’ç»è®©æ­¥ï¼ŒåšæŒè‡ªå·±çš„æ¡ä»¶ï¼Œè¿½æ±‚â€œèµ¢-è¾“â€ç»“æœã€‚å¸¸è§è¯­è¨€åŒ…æ‹¬ï¼šâ€œæˆ‘ä¸ä¼šæ”¹â€ã€â€œè¿™æ˜¯åº•çº¿â€ã€â€œç…§æˆ‘è¯´çš„åŠæ‰è¡Œâ€",
            "åˆä½œå‹": "æ­¤é£æ ¼çš„ä¸ªä½“æ—¢é«˜åº¦åšæŒè‡ªèº«éœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿé«˜åº¦å…³æ³¨ä»–æ–¹åˆ©ç›Šï¼Œå¼ºè°ƒå…±åŒè§£å†³é—®é¢˜ã€‚ä»–ä»¬å€¾å‘äºé€šè¿‡æ·±å…¥æ²Ÿé€šã€ç›¸äº’ç†è§£å’Œå…±å»ºæ–¹æ¡ˆï¼Œæ‰¾åˆ°ä¸€ä¸ªèƒ½å…¼é¡¾åŒæ–¹æ ¸å¿ƒå…³åˆ‡çš„â€œåŒèµ¢â€ç»“æœã€‚å¸¸ç”¨è¡¨è¾¾åŒ…æ‹¬ï¼šâ€œæˆ‘ä»¬å¯ä»¥ä¸€èµ·æƒ³åŠæ³•â€ã€â€œä½ å¸Œæœ›æ€æ ·è§£å†³ï¼Œæˆ‘ä»¬å¯ä»¥èŠèŠâ€ã€‚â€œè¿™ä¸ªå¯¹ä½ æˆ‘éƒ½å…¬å¹³å—ï¼Ÿâ€",
            "å¦¥åå‹": "æ­¤ç±»å‹åœ¨åšæŒä¸åˆä½œä¹‹é—´å¯»æ±‚å¹³è¡¡ï¼Œå€¾å‘äºé€šè¿‡äº’ç›¸è®©æ­¥æ¢å–éƒ¨åˆ†ç›®æ ‡çš„è¾¾æˆï¼Œè¿½æ±‚â€œå„é€€ä¸€æ­¥â€çš„æŠ˜ä¸­æ–¹æ¡ˆã€‚ä»–ä»¬å¸¸è¯´ï¼šâ€œä¸å¦‚æˆ‘ä»¬éƒ½è®©ä¸€ç‚¹â€ã€â€œè™½ç„¶ä¸å®Œç¾ï¼Œä½†èƒ½æ¥å—â€ã€â€œè¿™ä¸ªæ–¹æ¡ˆæˆ‘ä»¬éƒ½ä½œäº›è°ƒæ•´å¦‚ä½•ï¼Ÿâ€",
            "è¿å°±å‹": "è¯¥ç±»å‹ä¸ªä½“çš„åšæŒåº¦æä½ï¼Œåˆä½œåº¦è¾ƒé«˜ï¼Œéå¸¸ä¸å–„äºè¡¨è¾¾è‡ªå·±çš„çœŸå®éœ€æ±‚ï¼Œé‡åˆ°é—®é¢˜å€¾å‘äºè¢«åŠ¨å’Œé¡ºä»ä»–äººã€‚ä»–ä»¬åœ¨å¯¹è¯ä¸­æå°‘ä¸»åŠ¨è¡¨è¾¾è‡ªèº«çœŸå®ç«‹åœºï¼Œå¸¸ç”¨è¯­è¨€åŒ…æ‹¬ï¼šâ€œæˆ‘ä¸å¤ªæ‡‚è¿™äº›ç¨‹åºâ€ã€â€œè¿™ä¸ªæˆ‘ä¸å¤ªæ‡‚â€¦â€¦å¦‚æœä½ ä»¬è§‰å¾—åˆé€‚æˆ‘å°±æ²¡æ„è§â€ã€â€œæˆ‘éƒ½å¯ä»¥â€ã€â€œä½ å†³å®šå§â€ã€â€œä½ æ€ä¹ˆæ–¹ä¾¿å°±æ€ä¹ˆæ¥â€",
            "å›é¿å‹": "è¯¥é£æ ¼ä¸ªä½“åœ¨åšæŒå’Œåˆä½œä¸Šéƒ½æä½ï¼Œé¢å¯¹å†²çªæ—¶å¸¸é€‰æ‹©å›é¿å’Œæ‹–å»¶ï¼Œæ—¢ä¸è¡¨è¾¾çœŸå®éœ€æ±‚ï¼Œä¹Ÿä¸å›åº”ä»–æ–¹è¯‰æ±‚ã€‚ä»–ä»¬å€¾å‘äºè½¬ç§»è¯é¢˜ã€æ¨¡ç³Šè¡¨æ€ã€å»¶è¿Ÿå†³ç­–ï¼Œå¸Œæœ›é—®é¢˜è‡ªè¡Œæ¶ˆæ•£ï¼Œé¿å…æ­£é¢å†²çªã€‚å…¸å‹è¡¨è¾¾åŒ…æ‹¬ï¼šâ€œè¿™ä¸ªä¸å¥½è¯´â€ã€â€œæˆ‘ç°åœ¨æ²¡æ³•å†³å®šâ€ã€â€œè¿‡å‡ å¤©å†è¯´å§â€"
        }

        if a >= 7 and c <= 3:
            return "ç«äº‰å‹ï¼š" + TKI_PERSONALITY_PRESETS["ç«äº‰å‹"]
        elif a >= 7 and c >= 7:
            return "åˆä½œå‹ï¼š" + TKI_PERSONALITY_PRESETS["åˆä½œå‹"]
        elif a <= 3 and c <= 3:
            return "å›é¿å‹ï¼š" + TKI_PERSONALITY_PRESETS["å›é¿å‹"]
        elif a <= 3 and c >= 7:
            return "è¿å°±å‹ï¼š" + TKI_PERSONALITY_PRESETS["è¿å°±å‹"]
        else:
            return "å¦¥åå‹ï¼š" + TKI_PERSONALITY_PRESETS["å¦¥åå‹"]

    def print_info(self):
        """
        æ‰“å° player çš„é…ç½®ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•ã€‚
        """
        history_info = "\næœ€è¿‘çŠ¶æ€å˜åŒ–è®°å½•ï¼š"
        for i, record in enumerate(self.state_history[-5:]):
            history_info += f"\n  Round {i+1}: assertiveness={record['assertiveness']}, cooperativeness={record['cooperativeness']}"

        return f"\nğŸ§  Player ä¿¡æ¯ - {self.name}" + \
            "\n" + "=" * 40 + \
            "\nğŸ§¾ Role Description:" + \
            "\n" + history_info
    
    def generate_vent_prompt(self, observation):
        """
        æƒ…æ„Ÿå®£æ³„é˜¶æ®µ çš„ prompt: role_prompt + å¯¹è¯å†å² + è®¨è®ºçš„æ³¨æ„äº‹é¡¹
        """
        lines = []
        history = observation['history']
        for msg in history:
            lines.append(f"{msg['agent_name']}: {msg['content']}")
        "\n".join(lines) + f"\n{self.name}:"
        return f"""ã€å„æ–¹è‡ªæˆ‘ä»‹ç»å¼€å§‹ã€‘
{self.statement_history}
ã€å„æ–¹è‡ªæˆ‘ä»‹ç»ç»“æŸã€‘
ã€å¯¹è¯å†å²å¼€å§‹ã€‘
{"\n".join(lines)}
ã€å¯¹è¯å†å²ç»“æŸã€‘

å½“å‰è°ƒè§£è¿›å…¥æƒ…ç»ªè¡¨è¾¾é˜¶æ®µã€‚è¯·ä½ ç»“åˆå·²æœ‰çš„å¯¹è¯å†å²ã€è°ƒè§£è¿‡ç¨‹ä¸­çš„äº’åŠ¨ï¼Œä½œä¸ºä¸€æ–¹å½“äº‹äººï¼ŒçœŸå®è¡¨è¾¾ä½ åœ¨æ•´ä¸ªäº‹ä»¶ä¸­ç§¯ç´¯çš„æƒ…ç»ªã€æ„Ÿå—ä¸å›°æƒ‘ã€‚ 

å‘è¨€è¦æ±‚ï¼š
- æ¯è½®æœ€å¤šä¸‰å¥è¯ï¼›
- ç¦æ­¢é‡å¤å‰ä¸€è½®å†…å®¹æˆ–æ— æ„ä¹‰å¥—è¯ï¼›

ç°åœ¨ï¼Œè¯·ä½ ä»¥{self.name}çš„èº«ä»½ï¼Œè¯´å‡ºä½ æ­¤åˆ»æœ€çœŸå®çš„æƒ…ç»ªæˆ–æ„Ÿå—ï¼š
"""
    
    def add_vent_history(self, vent_history):
        """
        agent è‡ªå·±è®°å¿† æƒ…æ„Ÿå‘æ³„ é˜¶æ®µçš„è®°å¿†
        """
        prompt = f"""ä»¥ä¸‹æ˜¯ä½ åœ¨æƒ…æ„Ÿå‘æ³„é˜¶æ®µç»å†çš„äº‹ä»¶è®°å½•ï¼Œè¯·ä½ å¯¹è¯¥è®°å½•è¿›è¡Œæ€»ç»“ï¼Œè¦åŒ…æ‹¬æ‰€æœ‰è¦ç‚¹ï¼Œå½¢æˆé•¿æœŸè®°å¿†ã€‚
{vent_history}        
è¯·è¾“å‡ºä¸€æ®µå‹ç¼©æè¿°ï¼š      
"""
        messages=[{"role": "user", "content": self.generate_role_prompt() + prompt}]
        result = LLM(messages, self.args.model_name, self.args.temperature, self.args.max_tokens)
        self.vent_history = result['result']